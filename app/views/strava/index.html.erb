<h1> Run Log </h1>
<% if user_signed_in? %>
    <%= link_to "See last 100 runs", runlog_oauth_path, class: 'btn btn-primary' %>
    <%= link_to "Run manager", runs_path, class: 'btn btn-primary' %>
<% end %>

<br/>
<br/>

<%# render partial: "github_partial" %>

<% (2021..2023).each do |year| %>
<% get_weeks_and_tabel(year) do |year_array, labels| %>
  <h1> <%= year %> </h1>
  <table role="grid" aria-readonly="true" class="ContributionCalendar-grid js-calendar-graph-table" style="border-spacing: 4px; overflow: hidden; position: relative" aria-describedby="contribution-graph-description">
    <caption class="sr-only">Contribution Graph</caption>
    <thead>
      <tr style="height: 15px">
        <td style="width: 29px">
          <span class="sr-only">Day of Week</span>
        </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[0] %>" style="position: relative">
            <span class="sr-only">January</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Jan</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[1] %>" style="position: relative">
            <span class="sr-only">Feburary</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Feb</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[2] %>" style="position: relative">
            <span class="sr-only">March</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Mar</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[3] %>" style="position: relative">
            <span class="sr-only">April</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Apr</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[4] %>" style="position: relative">
            <span class="sr-only">May</span>
            <span aria-hidden="true" style="position: absolute; top: 0">May</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[5] %>" style="position: relative">
            <span class="sr-only">June</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Jun</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[6] %>" style="position: relative">
            <span class="sr-only">July</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Jul</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[7] %>" style="position: relative">
            <span class="sr-only">August</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Aug</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[8] %>" style="position: relative">
            <span class="sr-only">September</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Sep</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[9] %>" style="position: relative">
            <span class="sr-only">October</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Oct</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[10] %>" style="position: relative">
            <span class="sr-only">November</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Nov</span>
          </td>
          <td class="ContributionCalendar-label" colspan="<%= labels[11] %>" style="position: relative">
            <span class="sr-only">December</span>
            <span aria-hidden="true" style="position: absolute; top: 0">Dec</span>
          </td>
      </tr>
    </thead>
    <tbody>
      <% (0..6).each do |day_index| %>
        <tr style="height: 11px">

          <%# DAY LABEL %>
          <td class="ContributionCalendar-label" style="position: relative">
            <span class="sr-only">
              <%= (year_array[2])[day_index].strftime('%A') %>
            </span>
            <span aria-hidden="true"  style="clip-path: <%=day_index%2==0 ? "Circle(0)" : "None"%>; position: absolute; bottom: -4px">
              <%= (year_array[2])[day_index].strftime('%a') %>
            </span>
          </td>

          <%# DAY SQUARES %>
          <% (0..52).each do |week_index| %>
            <% get_day(year_array, week_index, day_index) do |day, run| %>
            <% if day == nil %>
              <td> </td>
            <% else %>
              <td 
                tabindex=<%= week_index == 0 ? "0" : "-1" %> 
                style="width: 11px; background-color: <%= get_color_str(run) %>; fill: <%= get_color_str(run) %>;" 
                class="ContributionCalendar-day" 
                data-bs-toggle="tooltip" 
                data-bs-placement="top"
                data-bs-custom-class="custom-tooltip"
                data-bs-title="<%= run != nil ? run.distance : 0.0  %> on <%= get_date_str(day) %>"
                >
                <span class="sr-only"></span>
              </td>
            <% end %>
            <% end %>
          <% end %>
        </tr>
      <% end %>
    </tbody> 
  </table>
<% end %>
<% end %>